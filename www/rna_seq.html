<html>
<meta >
<head>
<meta name="google-site-verification" content="OzrZ5nFulNwQ1tXMi9ItSQUJV9VnyuoqZgGuh_KXyMg" />
<link rel="shortcut icon" href="https://icgc.org/files/org_sys/pan.png">
        <title>ICGC PanCancer Status</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <meta name="generator" content="Geany 1.23.1" />
        <meta charset="utf-8" http-equiv="refresh" content="600">
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="style1.css">
        <!-- I recommend you host this file on your own, since this will change without warning -->
        <script src="http://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
        <link rel="stylesheet" type="text/css" href="http://bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
        <meta charset="utf-8" http-equiv="refresh" content="600">

<script type="text/javascript">
updateTable = function(ele,jsonFile) {
        var table = document.getElementsByName(ele);
        var json_data;
        var cell_1 = [];
        var cell_2 = [];
        var cell_3 = [];
        var val_1 = [];
        var val_2 = [];
        var val_3 = [];
        var total_1 = 0;
        var total_2 = 0;
        var total_3 = 0;


        d3.json(jsonFile, function(error, json) {
                json_data = json;

                var arr =[];

                 for (var i = 0; i < json_data.length; i++){


                cell_1[i] = table[0].rows[1].cells[i+1];
                val_1[i] = cell_1[i].firstChild.data;
                cell_1[i].firstChild.data = ''+json_data[i].align;
                total_1 += json_data[i].align;

                cell_2[i] = table[0].rows[2].cells[i+1];
                val_2[i] = cell_2[i].firstChild.data;
                cell_2[i].firstChild.data = ''+json_data[i].remaining;
                total_2 += json_data[i].remaining;

                cell_3[i] = table[0].rows[3].cells[i+1];
                val_3[i] = cell_3[i].firstChild.data;
                cell_3[i].firstChild.data = ''+json_data[i].total_unalign;
                total_3 += json_data[i].total_unalign;

                }

        cell_1[9] = table[0].rows[1].cells[9];
        cell_2[9] = table[0].rows[2].cells[9];
        cell_3[9] = table[0].rows[3].cells[9];


        cell_1[9].firstChild.data = '' + total_1;
        cell_2[9].firstChild.data = '' + total_2;
        cell_3[9].firstChild.data = '' + total_3;

        cell_1[10] = table[0].rows[1].cells[9];
        cell_2[10] = table[0].rows[2].cells[9];
        cell_1[11] = table[0].rows[1].cells[10];
        cell_2[11] = table[0].rows[2].cells[10];

        var ave_1 = (total_1/total_3)*100;
        var num_1 = ave_1.toFixed(2);
        var ave_2 = (total_2/total_3)*100;
        var num_2 = ave_2.toFixed(2);

        cell_1[11].firstChild.data = '' + num_1;
        cell_2[11].firstChild.data = '' + num_2;

        });
    }

    var makeMap = function(mapContainer,mapData) {
      var colors = d3.scale.category10();

      var mC = document.getElementById(mapContainer);
      if (!mC) {
        alert('element '+mapContainer+' not found!');
        return '<pre>Error: map container '+mapContainer+' not found</pre>';
      }


     //basic map config with custom fills, mercator projection
      var map = new Datamap({
        scope: 'world',
        element: mC,
        geographyConfig: {
          popupOnHover: false,
          highlightOnHover: false,
          highlightFillColor: '#ABDDA4',
        },
        projection: 'mercator',
        fills: {defaultFill: "#ABDDA4",
                gt50: colors(Math.random() * 20),
                gt60: "#63AFD0",
                gt70: "#0772A1",}
      })

     var json_data;

       d3.json(mapData, function(error, json) {
         json_data = json;
         map.bubbles(json_data, {
           popupTemplate: function(geo, data) {
           return "<div class='hoverinfo'>"+data.name+"<br/>Aligned: " + data.aligned + " Total: " +data.total+ "</div>";
        }
      });
    });
  }
 </script>

</head>
<style>
        #headere{
                background-color: #7FB5DA;

        }
        #inside{
                line-height: 50px;
                font-size:12px;
        }

</style>
<body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-34523087-2', 'pancancer.info');
  ga('create', 'UA-52348443-1', 'auto', {'name': 'newTracker'});
  ga('send', 'pageview');
  ga('newTracker.send', 'pageview');

</script>
<center>

  <div id="pancancer-header"></div>
  <script type="text/javascript">
    $("#pancancer-header").load("header.html");
  </script>

  <h2>RNA-Seq Alignment Status</h2>

  <p style="width:900px;">The tables and maps below show the number of specimens whose unaligned, lane-level WGS reads have been uploaded to a GNOS repository at one of the PanCancer clouds. Typically there are two specimens per donor, a tumor and a normal, and we expect approximately 3,000 specimens from ICGC and 2,000 from TCGA. It also
    shows the count of those specimens aligned using the project's BWA-Mem workflow.  For more information see our
    <a href="https://wiki.oicr.on.ca/display/PANCANCER/PCAWG+Home">Wiki Space</a>.</p>

<center>
<p>For access to the daily-created JSON files used for this table and our ElasticSearch index please click <a href="gnos_metadata/">here</a>.<br>
Details about this index can be found <a href="https://github.com/ICGC-TCGA-PanCancer/pancancer-sandbox/tree/develop/pcawg_metadata_parser">here</a>.</p>
</center>
<div id="#datatotal" style="width:911px;">
<p style="float:left;">A comparison of donor alignment status across projects. This removes test data and factors in duplication of specimens across multiple GNOS repositories, producing the most accurate count of available donors we have available.</p>

<p>
<br>
<table name ="x9" id="rounded-corner" summary="">
<thead>
<tr>
    <th nowrap>Project code</th>
    <th>Donors with RNA-Seq alignment</th>
    <th>Both TOPHAT and STAR aligned in tumor</th>
    <th>TOPHAT aligned, STAR unaligned in tumor</th>
    <th>STAR aligned, TOPHAT unaligned in tumor</th>
    <th>Donors with both normal and tumor alignment</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</p>
</div>

<script type="text/javascript">
$(document).ready(function () {
    report_data_url = "gnos_metadata/latest/reports/donors_RNA_Seq_alignment_summary/"; 
    $.getJSON(report_data_url + "donor.json",
    function (json) {
        var t_donors_with_RNA_Seq_alignment = 0;
        var t_both_tophat_and_star_aligned_in_tumor = 0;
        var t_tophat_aligned_star_not_in_tumor = 0;
        var t_star_aligned_tophat_not_in_tumor = 0;
        var t_donors_with_both_normal_and_tumor_alignment = 0;
        var ctypes = ['donors_with_RNA_Seq_alignment', 'both_tophat_and_star_aligned_in_tumor', 'tophat_aligned_star_not_in_tumor','star_aligned_tophat_not_in_tumor', 'donors_with_both_normal_and_tumor_alignment'
                     ];
        var total = [0, 0, 0, 0, 0];
        var tr;
        for (var i = 0; i < json.length; i++) {
            for (var j = 0; j < ctypes.length; j++) {
                total[j] += json[i][ctypes[j]];
            }
        }
        tr = $('<tr/>');
        tr.append("<td><font color=\"red\">[Total]</font></td>");
        for (var i = 0; i < total.length; i++) {
            tr.append("<td>" + total[i] + "</td>");
        }
        $("table[name='x9']").append(tr);

        for (var i = 0; i < json.length; i++) {
            tr = $('<tr/>');
            tr.append("<td>" + json[i].project + "</td>");
            
            for (var j = 0; j < ctypes.length; j++) {
                var cell_value = json[i][ctypes[j]] == 0 ? 0
                   : "<a target='abc' href='" + report_data_url + json[i]['project'] + "." + ctypes[j] + ".donors.txt'>" + json[i][ctypes[j]] + "</a>";
                tr.append("<td>" + cell_value + "</td>");
                total[j] += json[i][ctypes[j]];
            }
            $("table[name='x9']").append(tr);
        }


        tfoot = $('<tfoot/>');
        tfoot.append('<tr><td colspan="50">*Report processed: ' + json[0]['timestamp'] + '</td></tr>');
        $("table[name='x9']").append(tfoot);
    });
});
</script>


<script type="text/javascript">
//updates the table
        var table = document.getElementsByName("x");
        var table2 = document.getElementsByName("x9");
	var table3 = document.getElementsByName("x3");
	var json_data;
        var json_data2;
	var json_data3;
	var cell_1 = [];
        var cell_2 = [];
        var cell_3 = [];
        var cell_4 = [];
	var cell_5 = [];
        var cell_6 = [];
        var val_1 = [];
        var val_2 = [];
        var val_3 = [];
        var val_4 = [];
	var val_5 = [];
        var val_6 = [];
        var total_1 = 0;
        var total_2 = 0;
        var total_3 = 0;
        var total_4 = 0;
	var total_5 = 0;
        var total_6 = 0;
	var total_7 = 0;
        var total_8 = 0;
        var total_9 = 0;

	d3.json("train1.json", function(error, json) {
                json_data = json;
		var arr =[];
                //for (var i = 1,j = 0; i < json_data.length/2 + 2, j < json_data.length; i++, j+=2){
		for (var i = 0; i < json_data.length; i++){
                
                cell_1[i] = table[0].rows[1].cells[i+1];
                val_1[i] = cell_1[i].firstChild.data;
                cell_1[i].firstChild.data = ''+json_data[i].train_1_align;
                total_1 += json_data[i].train_1_align;
                
                cell_2[i] = table[0].rows[2].cells[i+1];
                val_2[i] = cell_2[i].firstChild.data;
                cell_2[i].firstChild.data = ''+json_data[i].remaining;
                total_2 += json_data[i].remaining;
                
                cell_3[i] = table[0].rows[3].cells[i+1];
                val_3[i] = cell_3[i].firstChild.data;
                cell_3[i].firstChild.data = ''+json_data[i].total_unalign;
                total_3 += json_data[i].total_unalign;
                }

	cell_1[8] = table[0].rows[1].cells[8];
	cell_2[8] = table[0].rows[2].cells[8];
	cell_3[8] = table[0].rows[3].cells[8];

	cell_1[8].firstChild.data = '' + total_1;
	cell_2[8].firstChild.data = '' + total_2;
	cell_3[8].firstChild.data = '' + total_3;

	cell_1[9] = table[0].rows[1].cells[9];

	var ave = (total_1/total_3)*100;
	var num = ave.toFixed(2);

	cell_1[9].firstChild.data = '' + num;
	
	});
</script>
</body>
</html>
